<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../js/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
    <link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <title>人员管理</title>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <![endif]-->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../js/bootstrap-table/bootstrap-table-zh-CN.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/thechart.js"></script>
    <style type="text/css">

        body {
            background: #eeeff2;
        }

        .cssPager {
            background: #FFFFFF none repeat scroll 0 0;
            border: 1px solid #CCCCCC;
            color: #1F3A87;
            margin: 5px 4px 0 0;
            padding: 4px 5px 0;
            text-decoration: none;
        }
        .anpager {
            font: 11px Arial, Helvetica, sans-serif;
            padding: 10px 20px 10px 0;
            margin: 0px;
        }

        .anpager a {
            padding: 1px 6px;
            border: solid 1px #ddd;
            background: #fff;
            text-decoration: none;
            margin-right: 2px
        }

        .anpager a:visited {
            padding: 1px 6px;
            border: solid 1px #ddd;
            background: #fff;
            text-decoration: none;
        }

        .anpager .cpb {
            padding: 1px 6px;
            font-weight: bold;
            font-size: 13px;
            border: none
        }

        .anpager a:hover {
            color: #fff;
            background: #ffa501;
            border-color: #ffa501;
            text-decoration: none;
        }
        .btn-warning:focus,.btn-warning:active,.btn-warning.active:focus,.btn-warning.active:focus{background-color:#f0ad4e;border-color:#eea236;}
    </style>

    <script>
        $(function () {
            $(".table-responsive").removeClass("panel").end();
            $(".table-responsive").find("div:first").addClass("panel").css("border", "none");

        })
    </script>

</head>

<body>
        <div class="container-fluid">
            <!-- 内容部分 -->
            <!-- 按时间查询 -->
            <div class="panel">
                <div class="row o-row">
                   
                    <div class="col-md-2">
                            <label class="control-label o-lable-sty">机构代码</label>
                        <input name="keyagencyid" type="text" id="keyagencyid" class="form-control" placeholder="机构代码"
                               style="display:inline;">
                    </div>
                    
                    <div class="col-md-2">
                            <label class="control-label o-lable-sty">机构名称</label>
                        <input name="keyagencyname" type="text" id="keyagencyname" class="form-control" placeholder="机构名称"
                               style="display:block;">
                    </div>
                    <div class="col-md-2">
                        <label class="control-label o-lable-sty">品牌</label>
                        <select id="keybrand" name="keybrand" class="form-control">
                            <option value="">全部</option>
                            <option th:each="map,userStat:${brand}" th:value="${map.brand}" th:text="${map.brand}" ></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                            <label class="control-label o-lable-sty">用户名/姓名</label>
                        <input name="keyname" type="text" id="keyname" class="form-control" placeholder="用户名/姓名"
                        style="display:block;">
                    </div>
                    
                    <div class="col-md-2">
                            <label class="control-label o-lable-sty">电话</label>
                        <input name="keytel" type="text" id="keytel" class="form-control" placeholder="电话"
                            style="display:block;">
                    </div>
                    <div class="col-md-2">
                            <label class="control-label o-lable-sty">是否有效</label>
                            <select name="keyvalid" id="keyvalid"
                                class="form-control">
                                <option selected="selected" value="-1">全部</option>
                                <option value="1">是</option>
                                <option value="0">否</option>
                            </select>
                        </div>
                    <div class="col-md-2">
                        <label class="control-label o-lable-sty">是否激活</label>
                        <select name="keyisactived" id="keyisactived"
                                class="form-control">
                            <option selected="selected" value="-1">全部</option>
                            <option value="1">是</option>
                            <option value="0">否</option>
                        </select>
                    </div>
                    <div class="col-md-1" style="width:80px;">
                            <label class="control-label o-lable-sty">&nbsp;</label>
                        <input type="button" name="Button3" value="查询" id="btnSearch" class="btn icon-search">
                    </div>

                    <div class="col-md-1" style="width:108px;">
                        <label class="control-label o-lable-sty">&nbsp;</label>
                        <button type="button" class="btn btn-warning ent-modal"  href="useredit" data-size="maxmodal" >添加用户</button>
                    </div>
                    <div class="col-md-1" style="width:120px;">
                        <label class="control-label o-lable-sty">&nbsp;</label>
                        <button type="button" class="btn btn-warning"  id="btnexport" >导出用户列表</button>
                    </div>
                </div>

            </div>

            <!-- chart图标 -->

            <!-- 表格 -->
            <div class="table-responsive">

                <div class="panel" style="border: none;">
                    <table cellspacing="0" rules="all" class="table table-striped table-bordered" border="1"
                        id="table1" style="border-collapse:collapse;"
                           data-show-columns="false"
                           data-pagination="true"
                           data-sortable="true"
                           data-resizable="true">
                        <thead>
                            <tr>
                                <th scope="col" data-field="username">用户名</th>
                                <th scope="col" data-field="truename">姓名</th>
                                <th scope="col" data-field="act">角色</th>
                                <th scope="col" data-field="agencyid" data-formatter="fmtagencyid">机构代码</th>
                                <th scope="col" data-field="brand">品牌</th>
                                <th scope="col" data-field="agencyname">机构名称</th>
                                <th scope="col" data-field="tel" data-formatter="fmtphone">联系电话</th>
                                <th scope="col" data-field="email"  >邮箱</th>
                                <th scope="col" data-field="valid" data-formatter="fmtvalid">有效</th>
                                <th scope="col" data-field="isactived" data-formatter="fmtisactived">激活</th>
                                <th scope="col" data-field="activetime" >激活时间</th>
                                <th scope="col" data-field="createddate" >创建时间</th>
                                <th data-field="id" data-formatter="fmthandler">操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>



            </div>




        </div>
        <script>
            var postParam={};
            var Search=function(){
                postParam={};
                if ($("#keyagencyid").val() != "") postParam.keyagencyid = $("#keyagencyid").val();
                if ($("#keyagencyname").val() != "") postParam.keyagencyname = $("#keyagencyname").val();
                if ($("#keyname").val() != "") postParam.keyname = $("#keyname").val();
                if ($("#keytel").val() != "") postParam.keytel = $("#keytel").val();
                postParam.keybrand = $("#keybrand").val();
                postParam.keyvalid = $("#keyvalid").val();
                postParam.keyisactived = $("#keyisactived").val();
                postParam.tokensign=$.cookie("tokensign");
                var gridOpts=$("#table1").bootstrapTable('getOptions');
                var parm = { "curPageIndex": gridOpts.pageNumber,
                    "pageSize": gridOpts.pageSize,
                    "action": "GetData"
                };
                $.ajaxQueryPage('#table1',$.extend(parm,postParam));
            };
            var fmtvalid=function(value,row){
                var v="";
                switch(parseInt(row.valid)){
                    case 0:
                        v="无效";
                        break;
                    case 1:
                        v="有效";
                        break;
                }
                return v;
            };
            var fmtagencyid=function (value,row) {
                var v=value;
                if(v=="zb"){
                    v="";
                }
                return v;
            }
            var fmtisactived=function(value,row){
                var v="";
                switch(parseInt(row.isactived)){
                    case 0:
                        v="否";
                        break;
                    case 1:
                        v="是";
                        break;
                }
                return v;
            };
            var fmtphone=function (value,row) {
                var v=value;
                if(value!=undefined&&value.length==11){
                    v=value.substring(0,3)+"******"+value.substring(9);
                }
                return v;
            }
            var fmthandler=function(index,row){
                var html="";
                html+="<a class='ent-modal' href='javascript:void(0);' data-size='3' role='useredit?id="+row.id+"'>编辑</a>";
                html+=" <a class='a' href='javascript:void(0);' key='" +row.id+"' onclick='ent.del(this);'>删除</a>";
                if(row.islock==1) {
                    html += " <a class='a' href='javascript:void(0);' key='" + row.id + "' onclick='ent.unlock(this);'>解锁</a>";
                }
                return html;
            };

            function exportFile(){


                //$.iframelink("exportagencyuser?action=Exportss"+"&keyagencyid="+$("#keyagencyid").val()+"&keyagencyname="+$("#keyagencyname").val()+"&keyname="+$("#keyname").val()+"&keytel="+$("#keytel").val()+"&keybrand="+$("#keybrand").val()+"&keyvalid="+$("#keyvalid").val()+"&keyisactived="+$("#keyisactived").val()+"&tokensign="+$.cookie("tokensign"));
                $.iframelink("exportagencyuser?action=Exportss&keyvalid=-1&keyisactived=-1");
            }
            var ent={
                unlock:function(e){
                    if(confirm("确定解锁？")){
                        var id=$(e).attr("key");
                        $.post(location.href,{ "action": "unlock", "id": id,"tokensign":$.cookie("tokensign") },function(d) {
                            if (d[0]) {
                                Search();
                            }else{
                                alert(d[1]);
                            }
                        });
                    }
                },
                del:function(e){
                    if(confirm("确定删除？")){
                        var id=$(e).attr("key");
                        $.post(location.href,{ "action": "del", "id": id,"tokensign":$.cookie("tokensign") },function(d) {
                            if (d[0]) {
                                Search();
                            }else{
                                alert(d[1]);
                            }
                        });
                    }
                }
            };
            $(function(){
                $("#table1").bootstrapTable({
                    onPageChange:function(number, size){
                        Search();
                    }
                });
                Search();
                $("#btnSearch").click(function(){
                    Search();
                });
                $("#btnexport").click(function(){
                    exportFile();
                    $(this).blur();
                });
                $(window).bind("keydown",function(event) {
                    var event=event||window.event;
                    if(event.keyCode==13) {
                        Search();
                    }
                });
            });

        </script>

</body>

</html>