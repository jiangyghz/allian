/*!
 * BootstrapSelection v0.1.0 (https://coding.net/u/packy/p/bootstrap-chinese-region/git)
 * Copyright 2015 packy <lpreterite@126.com>
 * Licensed under MIT (https://coding.net/u/packy/p/bootstrap-chinese-region/git/blob/master/LICENSE)
 */

!function(t,e){"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define("bs-chinese-region",["jquery","bootstrap"],e):e(t.jQuery)}(window,function(t){var e=function(e){this._areas=[],this._defaultId="",this.$el=e,this.$input=this.$el.find("input[type=text]"),this.$tabContent=this.$el.find(".tab-content"),this.$tabContent.children().first().on("click","a",t.proxy(this.onClearAreas,this)),this.$tabContent.children().on("click","a",t.proxy(this.onAreasChanged,this)),this.$tabContent.children().last().on("click","a",t.proxy(this.onClose,this)),this.$el.parents("form").on("submit",t.proxy(this.onSubmit,this)),t.fn.dropdown.Constructor&&this.initDropdownModule(),this._defaultId=void 0!==this.$el.data("def-val")?this.$el.find(this.$el.data("def-val")).val():this.$input.val(),this.submitType=this.$el.data("submit-type"),this.level(this.$el.data("min-level"),this.$el.data("max-level"))};e.prototype=new t.fn.dropdown.Constructor,e.prototype._toggle=e.prototype.toggle,e.prototype.toggle=function(){e.prototype._toggle.call(this.$input)},e.prototype.initDropdownModule=function(){this.$el.on("click",".dropdown-menu",function(e){t(e.target).trigger("click.bs.tab.data-api"),e.stopPropagation()})},e.prototype.onClearAreas=function(){this.areas=[]},e.prototype.onClose=function(e){this.toggle();this.getAreaData(t(e.target));this.$el.trigger("completed.bs.chinese-region",[this.areas])},e.prototype.onSubmit=function(){"id"==this.submitType&&this.$input.val(this.areas[this.areas.length-1].id)},e.prototype.getAreaData=function(t){var e=t.data();return e.name=t.text(),e},e.prototype.onAreasChanged=function(e){var i=t(e.target).attr("data-id");this.areas=this.getCurrentAreas(i),this.renderAreasPanel(this.getAreasByParentId(i)),this.$el.trigger("changed.bs.chinese-region",[this.areas])},e.prototype.getAreasByParentId=function(t){for(var e=[],i=0;i<this._source.length;i++)this._source[i].level>this.maxLevel||this._source[i].level<this.minLevel||this._source[i].parentId==t&&e.push(this._source[i]);return e},e.prototype.getAreasByLevel=function(t){for(var e=[],i=0;i<this._source.length;i++)this._source[i].level>this.maxLevel||this._source[i].level<this.minLevel||this._source[i].level==t&&e.push(this._source[i]);return e},e.prototype.getAreaById=function(t){for(var e,i=0;i<this._source.length;i++)if(this._source[i].id==t){e=this._source[i];break}return e},e.prototype.getCurrentAreas=function(t){for(var e=[],i=this.minLevel;i<=this.maxLevel;i++){var n=this.getAreaById(t);if(void 0===n)break;n.level>this.maxLevel||n.level<this.minLevel||(e.unshift(n),t=n.parentId)}return e},e.prototype.renderAreasPanel=function(t,e){var i,n;if(e?(i=this.$tabContent.children(":first"),n=this.$el.find(".nav-tabs li:first")):(i=this.$tabContent.children(".active").next(),n=this.$el.find(".nav-tabs li.active").next()),t&&t.length){i.empty();for(var r=0;r<t.length;r++){var s=t[r];i.append('<a href="javascript:;" class="areas-item" data-id="'+s.id+'" data-type="'+s.type+'">'+s.name+"</a> ")}}n.children("a").tab("show"),this.$input.val(""),this.$tabContent.children().find("a").removeClass("current");for(var r=0;r<this.areas.length;r++)this.$input.val(this.$input.val()+this.areas[r].name+" "),this.$tabContent.find("a[data-id="+this.areas[r].id+"]").addClass("current")},e.prototype.render=function(t){this.renderAreasPanel(this.getAreasByLevel(this.minLevel),!0),this.areas=this.getCurrentAreas(t);for(var e=0;e<this.areas.length;e++){var i=this.areas[e];this.renderAreasPanel(this.getAreasByParentId(i.id))}},e.prototype.source=function(t,e){return arguments.length<=0?this._source:(this._source="function"==typeof e?e(t):t,void this.render(this._defaultId))},e.prototype.level=function(t,e){this.minLevel=t,this.maxLevel=e},Object.defineProperty(e.prototype,"areas",{configurable:!1,get:function(){return this._areas},set:function(t){this._areas=t}}),Object.defineProperty(e.prototype,"minLevel",{configurable:!1,get:function(){return this._minLevel},set:function(t){this._minLevel=t}}),Object.defineProperty(e.prototype,"maxLevel",{configurable:!1,get:function(){return this._maxLevel},set:function(t){this._maxLevel=t}}),t.fn.chineseRegion=function(){var t=Array.prototype.shift.apply(arguments),i=arguments,n=this.data("bs-chinese-region");return void 0===n&&this.data("bs-chinese-region",n=new e(this)),"string"==typeof t&&n[t].apply(n,i),this},t.fn.chineseRegion.Constructor=e});